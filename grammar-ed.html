<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Grammar of Experimental Designs - 7&nbsp; Fundamentals</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./grammar-graphics.html" rel="next">
<link href="./grammar.html" rel="prev">
<link href="./figures/logos/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZBRNTDT9WG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZBRNTDT9WG', { 'anonymize_ip': true});
</script>

<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="site_libs/vis-9.1.0/vis-network.min.js"></script>
<script src="site_libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="stylesheet" href="./assets/fontawesome-free-6.1.1-web/css/font-awesome.min.css">
<script defer="" src="./assets/fontawesome-free-6.1.1-web/js/all.min.js"></script>
<script defer="" data-domain="emitanaka.org/edibble-book" src="https://plausible.io/js/plausible.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./grammar.html">Grammar</a></li><li class="breadcrumb-item"><a href="./grammar-ed.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Fundamentals</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./figures/logos/edibble-website-logo-blue.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Grammar of Experimental Designs</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/emitanaka/edibble-book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-terminology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Terminology</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-choices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Choices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-diagnosis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Diagnosis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./grammar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Grammar</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grammar-ed.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Fundamentals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grammar-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./grammar-edvis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Visualise</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Practice</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./practice-management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Management</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./practice-context.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Context</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./practice-teaching.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Teaching</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./practice-guides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Guides</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./toolbox.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Toolbox</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./toolbox-edibble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./cookbook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cookbook</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-crd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Completely randomised design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-rcbd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Randomised complete block design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-lsd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Latin square designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-factorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Factorial design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-bibd.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Balanced incomplete block design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-split.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Split-plot design</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cookbook-strip.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Strip-plot design</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#an-edibble-graph" id="toc-an-edibble-graph" class="nav-link active" data-scroll-target="#an-edibble-graph"><span class="header-section-number">7.1</span> An edibble graph</a></li>
  <li><a href="#an-edibble-table-or-data-frame" id="toc-an-edibble-table-or-data-frame" class="nav-link" data-scroll-target="#an-edibble-table-or-data-frame"><span class="header-section-number">7.2</span> An edibble table (or data frame)</a></li>
  <li><a href="#record-factor" id="toc-record-factor" class="nav-link" data-scroll-target="#record-factor"><span class="header-section-number">7.3</span> Record factor</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/emitanaka/edibble-book/edit/master/grammar-ed.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/emitanaka/edibble-book/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-grammar-ed" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Fundamentals</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
📖 Status of the book
</div>
</div>
<div class="callout-body-container callout-body">
<p>Hi there! This book is a work-in-progress. You may like to come back later when it’s closer to a complete state. If you would like to raise issues or leave feedback, please feel to do this:</p>
<ul>
<li>at <a href="https://github.com/emitanaka/edibble-book/issues">GitHub issues</a>,</li>
<li>email me at <a href="mailto:emi.tanaka@anu.edu.au">emi.tanaka@anu.edu.au</a>, or</li>
<li>leave it anonymously in the form <a href="https://docs.google.com/forms/d/e/1FAIpQLSeEkCGzHDaeQyWSheG3QPuVbO9_eNR5Z0Z1cNIf_zsBCH-vYQ/viewform?usp=sf_link">here</a>.</li>
</ul>
</div>
</div>
<p><a href="basics-terminology.html"><span>Chapter&nbsp;1</span></a> describe the basic terminology used in the field of experimental design. We can, however, describe some terms more fundamentally by considering every categorised entity (physical or otherwise) involved in the experiment to be a factor in the design. The two primary roles of a factor are treatments and units; under this categorisation blocks, experimental units and observational units are all just units – the explicit role of the unit is determined implicitly by the relationship of the factors. For example, if a treatment factor is allocated to a plot factor, then the plot is an experimental unit. Another special type of factor is the response, or more broadly an observational record of a unit, although these factors are often (although not always) used in the design of experiments.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule 1: Primary roles are encoded as a class
</div>
</div>
<div class="callout-body-container callout-body">
<p>All experimental factors must be encoded as an object with the factor class (e.g.&nbsp;<code>edbl_fct</code>) with primary roles as unit (<code>edbl_unit</code>), treatment (<code>edbl_trt</code>), record (<code>edbl_rcrd</code>) or other. Roles determined implicitly by relationship with other factors should not be encoded as a class.</p>
</div>
</div>
<p>In the grammar, a <strong>factor</strong> is an experimental variable manifested as an object with a dual structure: the “head system” and the “root system”. The <strong>head system</strong> characterizes the holistic attributes of the factor (e.g.&nbsp;the label “vaccine” for the treatment factor) and the <strong>root system</strong> is the constitution of the discrete factor levels such that it captures the idiosyncratic semantic features of each level that distinguish itself from other levels (e.g.&nbsp;labels “type A” and “type B” for the two types of vaccine treatment). Every root and head system has an <strong>outer form</strong> that is visible to the user (usually in the form of a vertex or a vector) and an <strong>inner form</strong> that are intrinsic characteristics of the outer form (e.g.&nbsp;id of the levels, the long name of the vaccines, dose level of each vaccine, etc). A factor can be physical (e.g.&nbsp;person, plot, animal and drug), metaphysical (e.g.&nbsp;gender, time and space) or unobserved (e.g.&nbsp;intended response measures). There are three types of information in the inner form:</p>
<ul>
<li>The <strong>constant inner form</strong> is the set of variables that cannot be directly modififed by the user; this is generally the IDs of the nodes.</li>
<li>The <strong>common inner form</strong> is the set of variables that are common across all factors, e.g.&nbsp;label and class of the node.</li>
<li>The <strong>specific inner form</strong> are variables that are set of variables that are specific to the factor – these are stored in a separate table.</li>
</ul>
<p>The inner form is not usually shown in the final design table (<code>edbl_table</code>).</p>
<p>In the system, every root system co-exists with a head system in a reciprocal relationship, i.e.&nbsp;any change in the root structure may be reflected as a change in head structure (and vice-versa). A schema of the factor structure is shown in <a href="#fig-factor-structure">Figure&nbsp;<span>7.1</span></a>.</p>
<div id="fig-factor-structure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/drawn/factor-structure.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7.1: A schema for the factor structure in the grammar.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule 2: Dual structure of factors
</div>
</div>
<div class="callout-body-container callout-body">
<p>All factor must have a dual structure that describes the head (holistic attributes of the factor) and root (constitution of the levels).</p>
</div>
</div>
<p>Every factor in the system is given an <strong>explicit role</strong> stored as a class in the inner quality of the head. The main roles are unit, treatment and record. The relationship between factors assigns an implicit role, e.g.&nbsp;treatment linked as a directed graph to a unit means that the unit is an experimental unit. The implicit roles are described in <a href="#tbl-implicit-role">Table&nbsp;<span>7.1</span></a>.</p>
<div id="tbl-implicit-role" class="anchored">
<table class="table">
<caption>Table&nbsp;7.1: Implicit role based on the relationship between factors</caption>
<thead>
<tr class="header">
<th style="text-align: left;">A</th>
<th style="text-align: left;">B</th>
<th style="text-align: left;"><span class="math inline">\(A \rightarrow B\)</span> relationship</th>
<th style="text-align: left;">Implicit role for B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">unit</td>
<td style="text-align: left;">unit</td>
<td style="text-align: left;">B is nested in A</td>
<td style="text-align: left;">Nested unit</td>
</tr>
<tr class="even">
<td style="text-align: left;">treatment</td>
<td style="text-align: left;">unit</td>
<td style="text-align: left;">B is applied to A</td>
<td style="text-align: left;">Experimental unit</td>
</tr>
<tr class="odd">
<td style="text-align: left;">record</td>
<td style="text-align: left;">unit</td>
<td style="text-align: left;">B is measured on A</td>
<td style="text-align: left;">Observational unit</td>
</tr>
</tbody>
</table>
</div>
<p>There are two orders of relationships in the system: the <strong>higher-order links</strong> between the factor nodes in the head system and the <strong>lower-order links</strong> between the level nodes in the root system. A higher-order link is created by explicit specification by the user and depending on how it is defined, the system creates the lower-order links between the root nodes with some constraint as prescribed by their explicit role and other user inputs.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule 3: Rules for relationships between factors
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="a">
<li>A higher-order link between any two head nodes must be explicitly specified by the user.</li>
<li>A lower-order link between any two root nodes cannot be made if there is no higher-order link between the head nodes linked to the two root nodes.</li>
</ol>
</div>
</div>
<div id="fig-example-network" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figures/drawn/example-factor-structure.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7.2: An example of the full schema of an experimental design with 3 factors: diet, subject, and day. There are three types of diet (Atkins, Keto, Vegan and Paleo), 4 different subjects per day over a total of two days.</figcaption>
</figure>
</div>
<p>An intermediate construct of the experimental design is stored as an object that contain two types of directed graphs, <span class="math inline">\(G_H = (V(G_H), E(G_H))\)</span> and <span class="math inline">\(G_L = (V(G_L), E(G_L))\)</span>, where <span class="math inline">\(V(G_F)\)</span> and <span class="math inline">\(V(G_L)\)</span> are sets of vertices and <span class="math inline">\(E(G_F)\)</span> and <span class="math inline">\(E(G_L)\)</span> are sets of edges. We refer <span class="math inline">\(G_F\)</span> and <span class="math inline">\(G_L\)</span> as factor graph and level graph, respectively. In the <strong>factor graph</strong>, every factor is represented as a single vertex. Every factor has a finite number of levels and each of these levels is represented as a single vertex in the <strong>level graph</strong>.</p>
<div class="cell">
<div class="cell-output-display">

<div id="htmlwidget-4f0534d15facbe8713e1" style="width:100%;height:200px;" class="visNetwork html-widget "></div>
<script type="application/json" data-for="htmlwidget-4f0534d15facbe8713e1">{"x":{"nodes":{"id":[1,2,3,4],"name":["mainplot","subplot","irrigation","fertilizer"],"class":["edbl_unit","edbl_unit","edbl_trt","edbl_trt"],"group":["unit","unit","trt","trt"],"label":["mainplot","subplot","irrigation","fertilizer"],"shape":["circle","circle","diamond","diamond"]},"edges":{"from":[1,3,4],"to":[2,1,2],"alloc":[null,1,2],"type":["nest","allot","allot"],"var_from":["mainplot","irrigation","fertilizer"],"var_to":["subplot","mainplot","subplot"],"arrows.middle.type":["arrow","arrow","arrow"],"dashes":[false,false,false],"arrows":["to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","id":"id"},"manipulation":{"enabled":false},"layout":{"randomSeed":3},"edges":{"id":"id"},"interaction":{"dragNodes":false,"dragView":false,"hover":false,"keyboard":false,"multiselect":false,"navigationButtons":false,"selectable":false,"zoomView":false,"zoomSpeed":1}},"groups":["unit","trt"],"width":"100%","height":"200px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Factor graph for a split plot design","style":"font-weight:bold;text-align:center;"},"submain":{"text":"","style":""},"footer":{"text":"","style":""},"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>A factor graph shows a high order view of the relationship between the factors in the experiment. In the above figure, there are two treatment factors: irrigation and fertilizer. Irrigation treatment is applied to the mainplot and the fertilizer treatment is applied to the subplot. The arrow from mainplot node to the subplot node implies that the subplot is nested in the mainplot. The shape and color of the node correspond to the class of the factor (e.g.&nbsp;unit, treatment).</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">

<div id="htmlwidget-5186ee3539011aaf7b17" style="width:100%;height:400px;" class="visNetwork html-widget "></div>
<script type="application/json" data-for="htmlwidget-5186ee3539011aaf7b17">{"x":{"nodes":{"idvar":[1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,4,4],"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],"name":["mainplot1","mainplot2","mainplot3","mainplot4","subplot1","subplot2","subplot3","subplot4","subplot5","subplot6","subplot7","subplot8","subplot9","subplot10","subplot11","subplot12","subplot13","subplot14","subplot15","subplot16","rainfed","irrigated","brand-A","brand-B"],"var":["mainplot","mainplot","mainplot","mainplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","irrigation","irrigation","fertilizer","fertilizer"],"label":["mainplot1","mainplot2","mainplot3","mainplot4","subplot1","subplot2","subplot3","subplot4","subplot5","subplot6","subplot7","subplot8","subplot9","subplot10","subplot11","subplot12","subplot13","subplot14","subplot15","subplot16","rainfed","irrigated","brand-A","brand-B"],"group":["mainplot","mainplot","mainplot","mainplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","subplot","irrigation","irrigation","fertilizer","fertilizer"],"shape":["circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","circle","diamond","diamond","diamond","diamond"]},"edges":{"from":[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,22,21,22,21,24,23,23,24,24,24,23,23,23,24,23,24,23,23,24,24],"to":[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"alloc":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],"type":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"lvl_from":["mainplot1","mainplot1","mainplot1","mainplot1","mainplot2","mainplot2","mainplot2","mainplot2","mainplot3","mainplot3","mainplot3","mainplot3","mainplot4","mainplot4","mainplot4","mainplot4","irrigated","rainfed","irrigated","rainfed","brand-B","brand-A","brand-A","brand-B","brand-B","brand-B","brand-A","brand-A","brand-A","brand-B","brand-A","brand-B","brand-A","brand-A","brand-B","brand-B"],"lvl_to":["subplot1","subplot2","subplot3","subplot4","subplot5","subplot6","subplot7","subplot8","subplot9","subplot10","subplot11","subplot12","subplot13","subplot14","subplot15","subplot16","mainplot1","mainplot2","mainplot3","mainplot4","subplot1","subplot2","subplot3","subplot4","subplot5","subplot6","subplot7","subplot8","subplot9","subplot10","subplot11","subplot12","subplot13","subplot14","subplot15","subplot16"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","id":"id"},"manipulation":{"enabled":false},"layout":{"randomSeed":1},"edges":{"id":"id"},"interaction":{"dragNodes":false,"dragView":false,"hover":false,"keyboard":false,"multiselect":false,"navigationButtons":false,"selectable":false,"zoomView":false,"zoomSpeed":1}},"groups":["mainplot","subplot","irrigation","fertilizer"],"width":"100%","height":"400px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":{"text":"Level graph for a split plot design","style":"font-weight:bold;text-align:center;"},"submain":{"text":"","style":""},"footer":{"text":"","style":""},"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
<p>The above figure shows the level graph. The nodes of the same color are the levels of the same factor (e.g.&nbsp;all yellow nodes correspond to the levels of the unit, subplot). The shape of the node correspond to the class of the corresponding factor.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule 4: All factors must be given an identity
</div>
</div>
<div class="callout-body-container callout-body">
<p>All nodes in the factor graph must be explicitly named.</p>
</div>
</div>
<p>Table <a href="#tbl-exam-table">Table&nbsp;<span>7.2</span></a> shows an example of an illustrative experiment that tests the exam score on a different exam time allocation for two different subjects. In such an experiment, the observational unit may be specified as the combination of Subject-Student, i.e.&nbsp;an observational unit can only be uniquely identified by using information across multiple factors. <strong>In the grammar, a factor cannot be implicitly assumed from other factors.</strong> This restriction means, for example, that a new factor, like Exam Booklet, which uniquely identifies every Subject-Student combination must be specified in the system. This restriction is not only for the purpose of internal graph representation but forces the user to confront what the observational units actually are. Naming things are hard, but without naming things, it can be hard to create a shared understanding about the experimental structure.</p>
<div id="tbl-exam-table" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table&nbsp;7.2: <strong>?(caption)</strong></p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-exam-table-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-exam-table" style="flex-basis: 100.0%;justify-content: center;">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<caption>(a) The table below shows the exam time allocation for every subject-student combination.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Exam Booklet</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Subject</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Student</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Exam Time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Math</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">Morning</td>
<td style="text-align: right;">58</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Science</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">Afternoon</td>
<td style="text-align: right;">90</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Math</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">Afternoon</td>
<td style="text-align: right;">39</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Science</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">Morning</td>
<td style="text-align: right;">80</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">


</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule 5: All factor levels must map to a single observational unit
</div>
</div>
<div class="callout-body-container callout-body">
<p>A viable experimental design is only specified if the relationship between the factors can be reconciled to a single observational unit.</p>
</div>
</div>
<section id="an-edibble-graph" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="an-edibble-graph"><span class="header-section-number">7.1</span> An edibble graph</h2>
<p>An edibble graph, or <code>edbl_graph</code> object, is a special type of directed graph. This form is used to represent intermediate constructs of the experimental design.</p>
<p>In a <strong><em>factor graph</em></strong>:</p>
<ul>
<li>a vertex is a variable,</li>
<li>an edge is a high-level connection between two variables, and</li>
<li>the direction of an edge defines a relationship based on which two variables it is connecting. Say if we have two nodes named A and B with a directed edge starting from A to B, then the meaning of the relationship follows from <a href="#tbl-implicit-role">Table&nbsp;<span>7.1</span></a>. If the combination is not listed below then the nodes cannot have a direct relationship.</li>
</ul>
<p>As an example, consider a split-plot design that contains 4 main plots with 2 sub plots within each main plot (so 8 subplots in total). There are 2 treatment factors: fertilizer (with levels A and B) and variety (with levels V1 and V2). Each level of the fertilizer is randomly applied to two main plots. Each level of variety is randomly applied to one sub plot within each main plot. Two responses are planned to be measured on the sub plots: yield and height.</p>
<p>In a <strong><em>level graph</em></strong>:</p>
<ul>
<li>a vertex is a level,</li>
<li>an edge is a direct connection between two levels, and</li>
<li>the direction of an edge defines the same relationship as for high-level view, except if the edge is connecting nodes of levels of the same unit variable then it represents the sequence order of the levels.</li>
</ul>
<p>The whole edibble graph object contains all the nodes and edges from the high- and low-level views. The whole edibble graph can have numerous nodes and edges, even when the number of units are small, that it’s visualisation will be too cluttered to be any useful. Consequently, when visualising these intermediate construct of the experimental design, only a high- or low-level view is visible to the user, but the object contains the information seen in both views.</p>
</section>
<section id="an-edibble-table-or-data-frame" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="an-edibble-table-or-data-frame"><span class="header-section-number">7.2</span> An edibble table (or data frame)</h2>
<p>An edibble, or <code>edbl_table</code> object, is a special class of <a href="https://tibble.tidyverse.org/"><code>tibble</code></a>. The word “edibble” itself already implies that it is a table so appending the word with table or data frame seems superfluous. However, edibble can refer to the package, object, or used as an adjective to other objects, so appending edibble with table or data frame is to make explicit emphasis it refers to the <code>edbl_table</code> object, otherwise the reader is expected to infer its meaning by context.</p>
<p>An <code>edbl_table</code> was originally called <code>edbl_df</code> following convention from tibble but I decided to break away from this since other edibble components are <em>graph</em> and <em>design</em>, so a two letter word felt too short in contrast.</p>
<p>An edibble data frame is produced when the variables can be laid out in a <a href="https://www.jstatsoft.org/article/view/v059i10">tidy data</a> format. An edibble is constructed from two possible ways:</p>
<ol type="1">
<li>converting edibble graph to edibble using <code>serve_table</code> and</li>
<li>converting existing data frame to edibble using <code>edibble</code>.</li>
</ol>
</section>
<section id="record-factor" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="record-factor"><span class="header-section-number">7.3</span> Record factor</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./grammar.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Grammar</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./grammar-graphics.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Graphics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>